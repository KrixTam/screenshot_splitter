# 手机截图拆解工具 (Screenshot Splitter)

这是一个专为手机截图设计的自动化拆解工具。它利用像素级单色扫描技术与 OpenAI 视觉模型，自动识别截图中的水平分割区域，并将截图精准切割成独立的逻辑 UI 模块。

## 快速开始 (Quick Start)

### 1. 环境准备
确保本地已安装 Node.js (推荐 v18+)。

### 2. 安装依赖
```bash
npm install
```

### 3. 配置环境变量
在项目根目录创建 `.env` 文件，并填入你的 OpenAI API 配置（支持 Ollama 等本地模型）：
```env
OPENAI_API_KEY=your_sk_key_here
# 可选：自定义接口地址
OPENAI_BASE_URL=https://api.openai.com/v1
# 可选：自定义模型名称
MODEL=gpt-4o
# 可选：是否启用 JSON Schema 响应格式（0/1）
JSON_SCHEMA=0
# 可选：LLM 并发度（每批次并发调用数量）
LLM_CONCURRENCY=4
# 可选：第一阶段序列大小（每个序列包含的内容块数）
LLM_BATCH=5
```

### 4. 启动项目
```bash
npm run dev
```
启动后访问 http://localhost:3000 即可使用。

## 核心功能逻辑

### 1. 像素级初拆 (Pixel-based Split)
*   扫描逻辑：逐行扫描图像像素以识别分割线。
*   分割识别：单色宽度占比 > 95% 即标记为分割区。
*   有效性校验：通过色彩模糊匹配和高度占比（默认 0.2%）过滤噪点与细碎装饰物。

### 2. 智能梳理拆解 (Refined Split)
*   双轮梳理机制：
    1.  首轮合并：基于滑动窗口，调用 GPT-4o 分析相邻有效区块的相关性（如：标题与内容、同组工具栏），并执行初步物理区域合并。
    2.  二次优化：针对首轮中未发生合并的“孤立区块”，将其与新的邻居（可能是第一轮产生的合并块）再次进行语义比对，确保复杂的 UI 组件能被完整聚合。
*   指标：引入“智能梳理度”，反映语义合并后 UI 组件的整合覆盖程度。

### 3. 数据持久化 (Backup & Restore)
*   支持完整工作流备份，包含所有物理碎片（有效块、无效块、分割区）以及智能梳理结果的元数据。
*   重要：备份文件存储区块在原图中的归一化坐标 (0-1000)，恢复时根据原图实时重切，确保最高清晰度。

